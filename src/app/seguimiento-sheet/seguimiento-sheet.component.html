<!-- FONDO -->
<div class="fixed inset-0 bg-black/40 z-40 bg-white" (click)="onClose()"></div>

<!-- CONTENEDOR -->
<div class="fixed inset-0 z-50 flex flex-col">
  <!-- MAPA (compacto con m√°rgenes laterales) -->
  <div class="bg-gray-100 py-3">
    <div class="mx-4 bg-white rounded-xl shadow-md overflow-hidden sm:mx-0
         md:mx-60
         lg:mx-60
         xl:mx-60">
      
      <!-- Header mapa -->
      <div class="px-4 py-2 text-sm font-semibold text-gray-700 border-b">
        üìç Ubicaci√≥n del pedido
      </div>

      <!-- Mapa -->
      <div #map class="h-[170px] w-full"></div>

    </div>
  </div>
  <!-- FICHA -->
  <section class="bg-white flex-1 overflow-y-auto sm:mx-0
         md:mx-60
         lg:mx-60
         xl:mx-60">

    <!-- INFO -->
    <div class="p-4 text-sm border-b space-y-1">
      <div class="grid grid-cols-[auto_1fr] gap-x-3">
          <span class="text-gray-500">Pedido</span>
          <strong class="text-right">{{ ord.order_code }}</strong>
      </div>

      <div class="grid grid-cols-[auto_1fr] gap-x-3">
          <span class="text-gray-500">Estado</span>
          <strong class="text-right">Normal</strong>
      </div>

      <div class="grid grid-cols-[auto_1fr] gap-x-3">
          <span class="text-gray-500">Producto</span>
          <strong class="text-right">{{ ord.prod_descr }}</strong>
      </div>

      <div class="grid grid-cols-[auto_1fr] gap-x-3">
          <span class="text-gray-500">Cantidad</span>
          <strong class="text-right">{{ ord.order_qty }} m¬≥</strong>
      </div>

    </div>

    <!-- ================= -->
    <!-- PROGRAMADO -->
    <!-- ================= -->
    <div
        class="p-4 bg-yellow-100 font-semibold cursor-pointer"
        (click)="toggle('programado')">
        Programado
        <!-- <span class="float-right">{{ ord.order_qty }} m¬≥</span> -->
        <span class="float-right">{{ m3Programado }} m¬≥</span>
    </div>

    <table *ngIf="accordion['programado']" class="w-full text-sm border-b text-center">
      <tr class="bg-gray-100">
        <th class="p-2">Planta</th>
        <th class="p-2">Cantidad</th>
        <th class="p-2">Hora en Obra</th>
      </tr>
       <tr *ngFor="let c of programados">
        <td class="p-2">{{ ord.plant_code }}</td>
        <td class="p-2">{{ c.cantidad }}</td>
        <td class="p-2">{{ c.hora }}</td>
      </tr>
    </table>

    <!-- ================= -->
    <!-- IMPRESO / CARGANDO -->
    <!-- ================= -->
    <div
        class="p-4 bg-yellow-100 font-semibold cursor-pointer"
        (click)="toggle('impreso')">
        Impreso / Cargando
        <span class="float-right">{{m3Impreso}} m¬≥</span>
    </div>

    <table *ngIf="accordion['impreso']" class="w-full text-sm border-b text-center">
      <tr class="bg-gray-100">
        <th class="p-2">Gu√≠a</th>
        <th class="p-2">Cami√≥n</th>
        <th class="p-2">Cantidad</th>
        <th class="p-2">Estado</th>
      <tr *ngFor="let c of impresos">
        <td class="p-2">{{ c.guia }}</td>
        <td class="p-2">{{ c.truck }}</td>
        <td class="p-2">{{ c.cantidad }}</td>
        <td class="p-2">CARGANDO</td>
        </tr>
    </table>

    <!-- ================= -->
    <!-- EN TR√ÅNSITO -->
    <!-- ================= -->
    <div
        class="p-4 bg-yellow-100 font-semibold cursor-pointer"
        (click)="toggle('transito')">
        En Tr√°nsito
        <span class="float-right">{{ m3Transito }} m¬≥</span>
    </div>

    <table *ngIf="accordion['transito']" class="w-full text-sm border-b text-center">
      <tr class="bg-gray-100">
        <th class="p-2">Gu√≠a</th>
        <th class="p-2">Cami√≥n</th>
        <th class="p-2">Cantidad</th>
        <th class="p-2">Hr. En Obra</th>
      </tr>
        <tr *ngFor="let c of enTransito">
        <td class="p-2">{{ c.guia }}</td>
        <td class="p-2">{{ c.truck }}</td>
        <td class="p-2">{{ c.cantidad }}</td>
        <td class="p-2">{{ c.hora }}</td>
      </tr>
    </table>

    <!-- ================= -->
    <!-- EN OBRA -->
    <!-- ================= -->
    <div
        class="p-4 bg-yellow-100 font-semibold cursor-pointer"
        (click)="toggle('obra')">
        En Obra
        <span class="float-right">{{ m3Obra }} m¬≥</span>
    </div>

    <table *ngIf="accordion['obra']" class="w-full text-sm border-b text-center">
      <tr class="bg-gray-100">
        <th class="p-2">Gu√≠a</th>
        <th class="p-2">Cami√≥n</th>
        <th class="p-2">Cantidad</th>
        <th class="p-2">Hr. En Obra</th>
      </tr>
      <tr *ngFor="let c of enObra">
        <td class="p-2">{{ c.guia }}</td>
        <td class="p-2">{{ c.truck }}</td>
        <td class="p-2">{{ c.cantidad }}</td>
        <td class="p-2">{{ c.hora }}</td>
      </tr>
    </table>

    <!-- ================= -->
    <!-- COMPLETADO -->
    <!-- ================= -->
    <div
        class="p-4 bg-yellow-100 font-semibold cursor-pointer"
        (click)="toggle('completado')">
        Completado
        <span class="float-right">{{ m3Completado }} m¬≥</span>
    </div>

    <table *ngIf="accordion['completado']" class="w-full text-sm text-center">
      <tr class="bg-gray-100">
        <th class="p-2">Gu√≠a</th>
        <th class="p-2">Cami√≥n</th>
        <th class="p-2">Cantidad</th>
        <th class="p-2">Terminado</th>
      </tr>
      <tr *ngFor="let c of completados">
        <td class="p-2">{{ c.guia }}</td>
        <td class="p-2">{{ c.truck }}</td>
        <td class="p-2">{{ c.cantidad }}</td>
        <td class="p-2">{{ c.hora }}</td>
      </tr>
    </table>
    <!-- ================= -->
    <!-- LOADING OVERLAY -->
    <!-- ================= -->
    <div
      *ngIf="loadingPrograma"
      class="absolute inset-0 z-50 flex items-center justify-center bg-white/70">
      
      <div class="flex flex-col items-center gap-2">
        <svg
          class="animate-spin h-10 w-10 text-yellow-600"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24">
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4">
          </circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z">
          </path>
        </svg>

        <span class="text-sm font-semibold text-gray-700">
          Cargando programa‚Ä¶
        </span>
      </div>
    </div>

    <!-- BOT√ìN -->
    <div class="p-4">
      <button
        class="w-full bg-cyan-700 text-white py-2 rounded-lg mt-12"
        (click)="onClose()">
        Cerrar
      </button>
    </div>

  </section>
</div>

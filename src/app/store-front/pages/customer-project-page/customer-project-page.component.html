<header class="bg-cyan-700 text-white p-4 rounded-t-lg flex justify-between items-center shadow-sm">
  <h1 class="text-xl font-semibold">Mis Pedidos</h1>
  <span class="text-sm opacity-90">
    Actualizado al {{ today | date:'dd/MM/yyyy' }}
  </span>
</header>

<div class="p-4 bg-gray-50">

  <!-- ========================= -->
  <!-- FILTROS -->
  <!-- ========================= -->
  <div class="bg-white shadow-md rounded-xl p-4 border border-gray-200 flex flex-col sm:flex-row sm:items-center gap-4">

    <div class="text-gray-600 text-center sm:text-left sm:mr-auto animate__animated animate__fadeIn">
      <div class="font-semibold flex items-center justify-center sm:justify-start gap-2"
           [ngClass]="{ 'mb-3 mt-3': authService.isAdmin()}">

        <svg xmlns="http://www.w3.org/2000/svg"
             class="h-4 w-4 text-cyan-600"
             fill="none"
             viewBox="0 0 24 24"
             stroke="currentColor">
          <path stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5.121 17.804A9 9 0 1118.879 17.804 A4.5 4.5 0 0012 13.5 a4.5 4.5 0 00-6.879 4.304z"/>
          <path stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 12a4 4 0 100-8 4 4 0 000 8z"/>
        </svg>

        <ng-container *ngIf="userCustCodes.length > 1; else singleCustomer">
          <select [(ngModel)]="selectedCustCode"
                  (change)="onCustomerChange()"
                  class="select select-bordered bg-gray-50">
            <option *ngFor="let code of userCustCodes"
                    [value]="code">
              {{ customersData[code].name || code }}
            </option>
          </select>
        </ng-container>

        <ng-template #singleCustomer>
          <span>{{ customerName }}</span>
        </ng-template>

      </div>
    </div>

    <!-- SELECT PROYECTO -->
    <select class="select select-bordered bg-gray-50 w-full sm:w-64"
            [(ngModel)]="selectedProject"
            (change)="onSelectProject()">
      <option value="">Todas las obras</option>
      <option *ngFor="let proj of projectOptions"
              [value]="proj.proj_code">
        {{ proj.proj_code }} - {{ proj.proj_name }}
      </option>
    </select>

    <!-- BOT√ìN LIMPIAR -->
    <button class="btn bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg shadow-sm w-full sm:w-auto mt-2 sm:mt-0"
            (click)="clearFilter()">
      <svg xmlns="http://www.w3.org/2000/svg"
           class="h-4 w-4"
           fill="none"
           viewBox="0 0 24 24"
           stroke="currentColor">
        <path stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 20l5-5m0 0l3 3m-3-3l6-6m3-3a2.828 2.828 0 10-4-4l4 4z"/>
      </svg>
      Limpiar
    </button>

  </div>


  <!-- ========================= -->
  <!-- MENSAJE SIN PROYECTO -->
  <!-- ========================= -->
  <div *ngIf="!hasSelectedProject"
      class="bg-white rounded-2xl mt-10 p-10 text-center text-gray-500 shadow animate__animated animate__fadeIn">

    <div class="flex justify-center mb-4">
      <svg xmlns="http://www.w3.org/2000/svg"
          class="w-14 h-14 text-cyan-600"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="1.5">
        <path stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 9v3.75m0 3h.008M10.29 3.86l-8.09 14.02A1.5 1.5 0 0 0 3.5 20.25h17a1.5 1.5 0 0 0 1.3-2.37L13.71 3.86a1.5 1.5 0 0 0-2.42 0Z" />
      </svg>
    </div>

    <!-- üëë ADMIN -->
    <ng-container *ngIf="authService.isAdmin(); else normalUser">
      <p class="text-lg font-semibold">Debes seleccionar un cliente y una obra</p>
      <p class="text-sm">
        Como administrador puedes cambiar de cliente y luego elegir el proyecto para ver la informaci√≥n.
      </p>
    </ng-container>

    <!-- üë§ USUARIO NORMAL -->
    <ng-template #normalUser>
      <p class="text-lg font-semibold">Debes seleccionar una obra</p>
      <p class="text-sm">
        Selecciona un proyecto para visualizar tu informaci√≥n.
      </p>
    </ng-template>

  </div>

  <!-- ‚úÖ SELECCIONADO -->
  <div *ngIf="isSelectionComplete"
      class="bg-white rounded-2xl mt-10 p-6 shadow animate__animated animate__fadeIn border border-cyan-200">

    <div class="flex items-center gap-3 mb-4">
      <div class="bg-cyan-100 p-2 rounded-full">
        <svg xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6 text-cyan-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor">
          <path stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 17v-6h13M9 5v6h13M3 12h.01"/>
        </svg>
      </div>

      <div>
        <p class="text-lg font-semibold text-gray-800">
          Selecci√≥n actual
        </p>
        <p class="text-sm text-gray-500">
          Informaci√≥n activa para mostrar
        </p>
      </div>
    </div>

    <div class="grid sm:grid-cols-2 gap-4 text-gray-700">

      <!-- Cliente (solo visible para admin o si quieres mostrar siempre) -->
      <div *ngIf="authService.isAdmin()">
        <p class="text-xs uppercase text-gray-400">Cliente</p>
        <p class="font-medium">
          {{ customerName || selectedCustCode }}
        </p>
      </div>

      <!-- Proyecto -->
      <div>
        <p class="text-xs uppercase text-gray-400">Proyecto</p>
        <p class="font-medium">          
          {{ selectedProjectData?.proj_name }}
        </p>
      </div>

    </div>

  </div>

</div>

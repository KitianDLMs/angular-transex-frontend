<div class="relative h-[calc(100vh-64px)] bg-gray-100">

  <!-- MAPA -->
  <div #map class="absolute inset-0"></div>

  <!-- HEADER -->
  <header class="absolute top-0 left-0 right-0 z-10 bg-white/90 backdrop-blur h-14 flex items-center px-4 shadow-sm">
    <button class="text-cyan-700 font-medium mr-3" (click)="goBack()">← Back</button>
    <h1 class="text-base font-semibold text-gray-900 mx-auto">Detalle Pedido</h1>
  </header>

  <!-- BOTTOM SHEET -->
  <section class="absolute bottom-0 left-0 right-0 z-20 bg-white rounded-t-2xl shadow-2xl max-h-[65vh] overflow-y-auto">

    <div class="flex justify-center py-2">
      <div class="w-10 h-1.5 bg-gray-300 rounded-full"></div>
    </div>

    <!-- INFO PRINCIPAL -->
    <div *ngIf="programaPedido().length" class="px-4 pb-4 space-y-3 text-sm">
      <div class="flex justify-between">
        <span class="text-gray-500">Pedido</span>
        <span class="font-medium">{{ programaPedido()[0].order_code }}</span>
      </div>

      <div class="flex justify-between">
        <span class="text-gray-500">Estado</span>
        <span class="font-medium">{{ programaPedido()[0].estado }}</span>
      </div>

      <div class="flex justify-between">
        <span class="text-gray-500">Producto</span>
        <span class="font-medium text-right max-w-[60%]">
          {{ programaPedido()[0].prod_descr }}
        </span>
      </div>

      <div class="flex justify-between">
        <span class="text-gray-500">Cantidad</span>
        <span class="font-medium">
          {{ programaPedido()[0].load_size }} m³
        </span>
      </div>
    </div>

    <hr />

    <details
    class="group"
    *ngIf="estadoActual === 'PROGRAMADO'"
    open
  >
    <summary class="flex justify-between items-center px-4 py-3 cursor-pointer">
      <span class="font-medium">Programado</span>
      <span class="group-open:rotate-180">⌄</span>
    </summary>

    <div class="px-4 pb-3 text-sm">
      <table class="w-full border text-center text-xs">
        <thead class="bg-gray-100">
          <tr>
            <th class="border p-1">Planta</th>
            <th class="border p-1">Guía</th>
            <th class="border p-1">Camión</th>
            <th class="border p-1">Cantidad</th>
            <th class="p-1 max-w-[160px] sm:max-w-none
                overflow-x-auto
                whitespace-nowrap
                scrollbar-thin">Hora en obra</th>
            <th class="border p-1">Estado</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="border p-1">{{ ord?.plant_code ?? '—' }}</td>
            <td class="border p-1">—</td>
            <td class="border p-1">—</td>
            <td class="border p-1">{{ ord?.load_size ?? '—' }}</td>
            <td class="border p-1">{{ programaPedido()[0].hora | date:'HH:mm' }}</td>
            
            <td class="border p-1">PROGRAMADO</td>
          </tr>
        </tbody>
      </table>
    </div>
    </details>

    <details
      class="group"
      *ngIf="estadoActual === 'CARGANDO'"
      open
    >
      <summary class="flex justify-between items-center px-4 py-3 cursor-pointer">
        <span class="font-medium">Impreso / Cargando</span>
        <span class="group-open:rotate-180">⌄</span>
      </summary>

      <div class="px-4 pb-3 text-sm">
        <table class="w-full border text-center text-xs">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-1">Planta</th>
              <th class="border p-1">Guía</th>
              <th class="border p-1">Camión</th>
              <th class="border p-1">Cantidad</th>
              <th class="border p-1">Hora</th>
              <th class="border p-1">Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border p-1">{{ ord?.plant_code ?? '—' }}</td>
              <td class="border p-1">{{ ord?.guia ?? '—' }}</td>
              <td class="border p-1">{{ ord?.camion ?? '—' }}</td>
              <td class="border p-1">{{ ord?.load_size ?? '—' }}</td>
              <td class="border p-1">—</td>
              <td class="border p-1">CARGANDO</td>
            </tr>
          </tbody>
        </table>
      </div>
    </details>

    <details
      class="group"
      *ngIf="estadoActual === 'EN TRANSITO'"
      open
    >
      <summary class="flex justify-between items-center px-4 py-3 cursor-pointer">
        <span class="font-medium">En tránsito</span>
        <span class="group-open:rotate-180 transition-transform">⌄</span>
      </summary>

      <div class="px-4 pb-4 space-y-4 text-sm">

        <!-- INFO -->
        <table class="w-full border text-center text-xs">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-1">Planta</th>
              <th class="border p-1">Guía</th>
              <th class="border p-1">Camión</th>
              <th class="border p-1">Cantidad</th>
              <th class="border p-1">Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border p-1">{{ ord?.plant_code ?? '—' }}</td>
              <td class="border p-1">{{ ord?.guia ?? '—' }}</td>
              <td class="border p-1">{{ ord?.camion ?? '—' }}</td>
              <td class="border p-1">{{ ord?.load_size ?? '—' }}</td>
              <td class="border p-1 font-medium text-cyan-600">
                EN TRANSITO
              </td>
            </tr>
          </tbody>
        </table>

        <!-- INDICADOR VISUAL -->
        <div class="flex justify-center">
          <div class="relative w-28 h-28 rounded-full border-4 border-cyan-500 flex items-center justify-center">
            <span class="text-xs font-medium text-cyan-700 text-center">
              Camión<br />en ruta
            </span>
          </div>
        </div>

      </div>
    </details>

    <details
      class="group"
      *ngIf="estadoActual === 'EN OBRA'"
      open
    >
      <summary class="flex justify-between items-center px-4 py-3 cursor-pointer">
        <span class="font-medium">En obra</span>
        <span class="group-open:rotate-180 transition-transform">⌄</span>
      </summary>

      <div class="px-4 pb-4 text-sm">

        <table class="w-full border text-center text-xs">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-1">Planta</th>
              <th class="border p-1">Guía</th>
              <th class="border p-1">Camión</th>
              <th class="border p-1">Cantidad</th>
              <th class="border p-1">Hora llegada</th>
              <th class="border p-1">Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border p-1">{{ ord?.plant_code ?? '—' }}</td>
              <td class="border p-1">{{ ord?.guia ?? '—' }}</td>
              <td class="border p-1">{{ ord?.camion ?? '—' }}</td>
              <td class="border p-1">{{ ord?.load_size ?? '—' }}</td>
              <td class="border p-1">{{ ord?.hora_llegada ?? '—' }}</td>
              <td class="border p-1 font-medium text-orange-600">
                EN OBRA
              </td>
            </tr>
          </tbody>
        </table>

      </div>
    </details>

    <details
      class="group"
      *ngIf="estadoActual === 'COMPLETADO'"
      open
    >
      <summary class="flex justify-between items-center px-4 py-3 cursor-pointer">
        <span class="font-medium">Completado</span>
        <span class="group-open:rotate-180 transition-transform">⌄</span>
      </summary>

      <div class="px-4 pb-4 text-sm">

        <table class="w-full border text-center text-xs">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-1">Planta</th>
              <th class="border p-1">Guía</th>
              <th class="border p-1">Camión</th>
              <th class="border p-1">Cantidad</th>
              <th class="border p-1">Hora término</th>
              <th class="border p-1">Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border p-1">{{ ord?.plant_code ?? '—' }}</td>
              <td class="border p-1">{{ ord?.guia ?? '—' }}</td>
              <td class="border p-1">{{ ord?.camion ?? '—' }}</td>
              <td class="border p-1">{{ ord?.load_size ?? '—' }}</td>
              <td class="border p-1">{{ ord?.hora_fin ?? '—' }}</td>
              <td class="border p-1 font-medium text-green-600">
                COMPLETADO
              </td>
            </tr>
          </tbody>
        </table>

      </div>
    </details>
  </section>
</div>

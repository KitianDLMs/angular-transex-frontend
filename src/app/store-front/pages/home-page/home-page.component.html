<div class="overflow-x-auto bg-white shadow-md rounded-lg mt-6 border border-gray-200">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold text-gray-800">Obras en Ejecución</h1>
    <span class="text-sm text-gray-500">Actualizado al {{ today | date:'dd/MM/yyyy' }}</span>
  </div>
  <table class="min-w-full border-collapse text-sm">
    <thead class="bg-gray-800 text-white">
      <tr>
        <th class="py-3 px-4 text-left font-semibold uppercase tracking-wide">Nombre</th>
        <th class="py-3 px-4 text-left font-semibold uppercase tracking-wide">Ubicación</th>
        <th class="py-3 px-4 text-right font-semibold uppercase tracking-wide">Presupuesto</th>
        <th class="py-3 px-4 text-center font-semibold uppercase tracking-wide">Inicio</th>
        <th class="py-3 px-4 text-center font-semibold uppercase tracking-wide">Término</th>
        <th class="py-3 px-4 text-left font-semibold uppercase tracking-wide">Encargado</th>
        <th class="py-3 px-4 text-left font-semibold uppercase tracking-wide">Descripción</th>
        <th class="py-3 px-4 text-center font-semibold uppercase tracking-wide">Progreso</th>
        <th class="py-3 px-4 text-center font-semibold uppercase tracking-wide">Estado</th>
      </tr>
    </thead>

    <tbody>
      @for (obra of obrasResource.value()?.obras; track obra.id) {
        <tr class="border-t hover:bg-gray-50 transition-colors duration-150">
          <td class="py-3 px-4 text-gray-800 font-medium">{{ obra.name }}</td>
          <td class="py-3 px-4 text-gray-600">{{ obra.location }}</td>
          <td class="py-3 px-4 text-right text-gray-700 font-semibold">
            {{ obra.budget | currency:'CLP':'symbol':'1.0-0' }}
          </td>
          <td class="py-3 px-4 text-center text-gray-600">
            {{ obra.startDate | date:'yyyy-MM-dd' }}
          </td>
          <td class="py-3 px-4 text-center text-gray-600">
            {{ obra.endDate | date:'yyyy-MM-dd' }}
          </td>
          <td class="py-3 px-4 text-gray-700">
            {{ obra.user?.fullName || obra.responsable || '—' }}
          </td>
          <td class="py-3 px-4 text-gray-600 max-w-xs truncate" title="{{ obra.description }}">
            {{ obra.description || '—' }}
          </td>
          <td class="py-3 px-4 text-center">
            <div class="w-24 mx-auto bg-gray-200 rounded-full h-2.5">
              <div
                class="bg-green-500 h-2.5 rounded-full"
                [style.width.%]="obra.progreso || 0"
              ></div>
            </div>
            <span class="text-xs text-gray-500">{{ obra.progreso || 0 }}%</span>
          </td>
          <td class="py-3 px-4 text-center">
            <span
              class="px-2 py-1 rounded-md text-xs font-medium"
              [ngClass]="{
                'bg-green-100 text-green-700': obra.estado?.toLowerCase() === 'finalizada',
                'bg-yellow-100 text-yellow-700': obra.estado?.toLowerCase() === 'en curso',
                'bg-red-100 text-red-700': obra.estado?.toLowerCase() === 'pendiente'
              }"
            >
              {{ obra.estado || 'Pendiente' }}
            </span>
          </td>
        </tr>
      }
    </tbody>
  </table>

  @if (obrasResource.isLoading()) {
    <div class="text-center p-6 text-gray-500 animate-pulse">
      Cargando obras...
    </div>
  }
</div>
<footer class="mt-10 text-xs text-gray-400 text-center">
  © 2025 TRANSEX CLIENT UI — Todos los derechos reservados.
</footer>
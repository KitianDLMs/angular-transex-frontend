<header class="bg-cyan-700 text-white p-4 rounded-t-lg flex justify-between items-center shadow-sm">
  <h1 class="text-xl font-semibold">Mis Productos</h1>
  <span class="text-sm opacity-90">
    Actualizado al {{ today | date:'dd/MM/yyyy' }}
  </span>
</header>

<div class="p-4 bg-gray-50">
<div
    class="bg-white shadow-md rounded-xl p-4 border border-gray-200
           flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">

        <!-- üëë DERECHA: CLIENTE -->
    <div *ngIf="selectedCustCode"
         class="flex items-center gap-2 bg-cyan-50 px-3 py-2 rounded-lg animate__animated animate__fadeIn">

      <svg xmlns="http://www.w3.org/2000/svg"
           class="h-4 w-4 text-cyan-600"
           fill="none"
           viewBox="0 0 24 24"
           stroke="currentColor">
        <path stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 12a4 4 0 100-8 4 4 0 000 8z"/>
        <path stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5.121 17.804A9 9 0 1118.879 17.804"/>
      </svg>

      <div class="text-sm text-left">
        <div class="text-gray-400 text-xs uppercase">Cliente</div>
        <div class="font-semibold text-gray-800">
          {{ customerName || selectedCustCode }}
        </div>
      </div>
    </div>

    <!-- üèó IZQUIERDA: PROYECTO -->
    <div class="flex items-center gap-4 animate__animated animate__fadeIn">

      <div *ngIf="selectedProject"
           class="flex items-center gap-2 bg-green-50 px-3 py-2 rounded-lg">

        <svg xmlns="http://www.w3.org/2000/svg"
             class="h-4 w-4 text-green-600"
             fill="none"
             viewBox="0 0 24 24"
             stroke="currentColor">
          <path stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 7h18M3 12h18M3 17h18"/>
        </svg>

        <div class="text-sm">
          <div class="text-gray-400 text-xs uppercase">Proyecto</div>

          <!-- üî• AQU√ç SE VE COMPLETO -->
          <div class="font-semibold text-gray-800 break-words max-w-[400px]">
            {{ selectedProjectName }}
          </div>
        </div>
      </div>

      <div *ngIf="!selectedProject"
          class="text-black text-md italic">
        <b>No hay proyecto seleccionado</b>
      </div>

    </div>

  </div>

  <div *ngIf="loading" class="flex flex-col items-center justify-center p-6 text-gray-500 gap-3 animate__animated animate__fadeIn">
    <img src="assets/images/logoHORMIGONES.png" alt="Cargando" class="h-8 w-8 animate-pulse" />
    <span>Cargando productos...</span>
  </div>

  <div *ngIf="!loading && products.length > 0"
      class="overflow-x-auto mt-6 bg-white rounded-lg shadow animate__animated animate__fadeIn">

    <table class="min-w-full text-sm">
      <thead class="bg-cyan-700 text-white">
        <tr>
          <th class="p-3 text-left">Producto</th>
          <th class="p-3 text-left">C√≥digo</th>
          <th class="p-3 text-left">Orden</th>
          <th class="p-3 text-left">Respaldado</th>
          <th class="p-3 text-left">Utilizado</th>
          <th class="p-3 text-left">Saldo</th>
        </tr>
      </thead>

      <tbody>
        <ng-container *ngFor="let p of products">

          <tr class="border-t bg-white hover:bg-cyan-50 cursor-pointer font-semibold"
              (click)="toggleGroup(p.codigo)">
            <td class="p-3 max-w-[160px] sm:max-w-none
                overflow-x-auto
                whitespace-nowrap
                scrollbar-thin">{{ p.producto }}</td>
            <td class="p-3">{{ p.codigo }}</td>
            <td class="p-3">‚Äî</td>
            <td class="p-3">{{ p.respaldado }}</td>
            <td class="p-3">{{ p.utilizado }}</td>
            <td class="p-3">{{ p.saldo }}</td>
          </tr>

          <ng-container *ngIf="expandedGroup === p.codigo">
            <tr *ngFor="let o of p.ordenes" class="bg-gray-100 text-sm">
              <td class="p-3 pl-8">‚Ü≥</td>
              <td class="p-3">{{ p.codigo }}</td>
              <td class="p-3 max-w-[160px] sm:max-w-none
                overflow-x-auto
                whitespace-nowrap
                scrollbar-thin">OC/{{ o.ordencompra }}</td>
              <td class="p-3">{{ o.respaldado }}</td>
              <td class="p-3">{{ o.utilizado }}</td>
              <td class="p-3">{{ o.saldo }}</td>
            </tr>
          </ng-container>

        </ng-container>
      </tbody>
    </table>
  </div>


  <div *ngIf="!loading && products.length === 0"
       class="bg-white shadow-lg rounded-2xl mt-10 border border-gray-200 p-10 text-center text-gray-500 animate__animated animate__fadeIn">
    <div class="flex justify-center mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-14 h-14 text-cyan-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 9v3.75m0 3h.008M10.29 3.86l-8.09 14.02A1.5 1.5 0 0 0 3.5 20.25h17a1.5 1.5 0 0 0 1.3-2.37L13.71 3.86a1.5 1.5 0 0 0-2.42 0Z" />
      </svg>
    </div>
    <p class="text-lg font-semibold mb-2">No tienes productos asignados</p>
    <p class="text-sm">Cuando existan productos, los ver√°s reflejados aqu√≠.</p>
  </div>

  <div *ngIf="!loading && products.length > 0" class="flex items-center justify-between mt-6 px-4">
    <button class="btn bg-gray-200 text-gray-700 hover:bg-gray-300 px-4 py-2 rounded-lg disabled:opacity-50"
            (click)="prevPage()"
            [disabled]="page === 1">
      ‚Üê Anterior
    </button>

    <div class="text-sm text-gray-600">
      P√°gina <strong>{{ page }}</strong> de <strong>{{ totalPages }}</strong>
    </div>

    <button class="btn bg-cyan-700 text-white hover:bg-cyan-800 px-4 py-2 rounded-lg disabled:opacity-50"
            (click)="nextPage()"
            [disabled]="page === totalPages">
      Siguiente ‚Üí
    </button>
  </div>
</div>

<header class="bg-cyan-700 text-white p-4 rounded-t-lg flex justify-between items-center shadow-sm">
  <h1 class="text-xl font-semibold">Mis Productos</h1>
  <span class="text-sm opacity-90">
    Actualizado al {{ today | date:'dd/MM/yyyy' }}
  </span>
</header>

<div class="p-4 bg-gray-50">

  <!-- FILTROS -->
  <div class="bg-white shadow-md rounded-xl p-4 flex flex-col sm:flex-row gap-4 items-center">
    <div class="text-gray-600 text-center sm:text-left sm:mr-auto animate__animated animate__fadeIn">
      <!-- Cliente -->
      <div class="font-semibold flex items-center justify-center sm:justify-start gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-cyan-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M5.121 17.804A9 9 0 1118.879 17.804 A4.5 4.5 0 0012 13.5 a4.5 4.5 0 00-6.879 4.304z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 12a4 4 0 100-8 4 4 0 000 8z"/>
        </svg>
        {{ customerName }}
      </div>

      <!-- Dirección -->
      <div class="text-sm text-gray-500 flex items-center justify-center sm:justify-start gap-2 mt-1">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 11c1.657 0 3-1.343 3-3s-1.343-3-3 -3 -3 1.343 -3 3 1.343 3 3 3z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19.5 11c0 7.5 -7.5 11 -7.5 11S4.5 18.5 4.5 11a7.5 7.5 0 1115 0z"/>
        </svg>
        {{ customerAddress }}
      </div>
    </div>

    <!-- SELECT PROYECTOS -->
    <select class="select select-bordered bg-gray-50 w-full sm:w-64"
            (change)="onSelectProject()"
            [(ngModel)]="selectedProject">
      <option value="">Todas las obras</option>
      <option *ngFor="let proj of projectOptions" [value]="proj.proj_code.trim()">
        {{ proj.proj_code.trim() }} - {{ proj.proj_name.trim() }}
      </option>
    </select>

    <button class="btn bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg shadow-sm w-full sm:w-auto mt-2 sm:mt-0"
            (click)="clearFilter()">
      Limpiar
    </button>
  </div>

  <!-- Cargando -->
  <div *ngIf="loading" class="flex flex-col items-center justify-center p-6 text-gray-500 gap-3 animate__animated animate__fadeIn">
    <img src="assets/images/logoHORMIGONES.png" alt="Cargando" class="h-8 w-8 animate-pulse" />
    <span>Cargando productos...</span>
  </div>

  <!-- TABLA PRODUCTOS -->
  <div *ngIf="!loading && products.length > 0" class="overflow-x-auto mt-6 bg-white rounded-lg shadow animate__animated animate__fadeIn">
    <table class="min-w-full text-sm">
      <thead class="bg-cyan-700 text-white">
        <tr>
          <th class="p-3 text-left">Producto</th>
          <th class="p-3 text-left">Código</th>
          <th class="p-3 text-left">Orden</th>
          <th class="p-3 text-left">Respaldado</th>
          <th class="p-3 text-left">Utilizado</th>
          <th class="p-3 text-left">Saldo</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let p of products">
          <tr class="border-t bg-white hover:bg-cyan-50 cursor-pointer font-semibold"
              (click)="toggleGroup(p.prodCode)">
            <!-- <td class="p-3">{{ p.prodDescr }}</td> -->
            <td class="p-3 max-w-xs whitespace-nowrap overflow-x-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100">
              {{ p.prodDescr }}
            </td>
            <td class="p-3">{{ p.prodCode }}</td>
            <td class="p-3">—</td>
            <td class="p-3">{{ p.totalRespaldado }}</td>
            <td class="p-3">{{ p.totalUtilizada }}</td>
            <td class="p-3">{{ p.saldo }}</td>
          </tr>

          <ng-container *ngIf="expandedGroup === p.prodCode">
            <tr *ngFor="let o of p.orders" class="bg-gray-100 text-sm">
              <!-- <td class="p-3 pl-8">↳ {{ p.prodDescr }}</td> -->
              <td class="p-3 pl-8 max-w-xs whitespace-nowrap overflow-x-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100">
                ↳ {{ p.prodDescr }}
              </td>
              <td class="p-3">{{ p.prodCode }}</td>
              <td class="p-3">OC/{{ o.orderCode }}</td>
              <td class="p-3">{{ o.cantidadRespaldo }}</td>
              <td class="p-3">{{ o.cantidadUtilizada }}</td>
              <td class="p-3">{{ o.saldo }}</td>
            </tr>
          </ng-container>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- SIN PRODUCTOS -->
  <div *ngIf="!loading && products.length === 0"
       class="bg-white shadow-lg rounded-2xl mt-10 border border-gray-200 p-10 text-center text-gray-500 animate__animated animate__fadeIn">
    <div class="flex justify-center mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-14 h-14 text-cyan-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 9v3.75m0 3h.008M10.29 3.86l-8.09 14.02A1.5 1.5 0 0 0 3.5 20.25h17a1.5 1.5 0 0 0 1.3-2.37L13.71 3.86a1.5 1.5 0 0 0-2.42 0Z" />
      </svg>
    </div>
    <p class="text-lg font-semibold mb-2">No tienes productos asignados</p>
    <p class="text-sm">Cuando existan productos, los verás reflejados aquí.</p>
  </div>

  <!-- PAGINACIÓN -->
  <div *ngIf="!loading && products.length > 0" class="flex items-center justify-between mt-6 px-4">
    <button class="btn bg-gray-200 text-gray-700 hover:bg-gray-300 px-4 py-2 rounded-lg disabled:opacity-50"
            (click)="prevPage()"
            [disabled]="page === 1">
      ← Anterior
    </button>

    <div class="text-sm text-gray-600">
      Página <strong>{{ page }}</strong> de <strong>{{ totalPages }}</strong>
    </div>

    <button class="btn bg-cyan-700 text-white hover:bg-cyan-800 px-4 py-2 rounded-lg disabled:opacity-50"
            (click)="nextPage()"
            [disabled]="page === totalPages">
      Siguiente →
    </button>
  </div>

  <!-- FOOTER -->
  <footer class="mt-28 bg-white border-t border-gray-200 px-4 py-10">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row gap-6">
      <div class="space-y-3 text-[11px] sm:text-xs text-gray-500">
        <p>© {{ currentYear }} Hormigones Transex Ltda. — Todos los derechos reservados.</p>
        <div class="flex flex-col gap-1">
          <!-- <a href="mailto:contacto@example.com" class="hover:text-cyan-700 transition">contactoexample.com</a> -->
          <a href="tel:+56212345678" class="hover:text-cyan-700 transition">+56 2 1234 5678</a>
          <span>Av. del Valle 10039, Ciudad Empresarial</span>
        </div>
      </div>
      <div class="flex justify-end mt-6 md:mt-0 md:ml-auto animate__animated animate__backInRight">
        <img src="assets/images/logoHORMIGONES2.png"
             alt="Hormigones Transex"
             class="h-8 sm:h-9 md:h-10 object-contain opacity-90" />
      </div>
    </div>
  </footer>

</div>
